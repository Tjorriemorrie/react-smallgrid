"use strict";var SmallGrid=React.createClass({displayName:"SmallGrid",getInitialState:function(){return{edit_idx:null,edit_prop:null,limit:20,page:1,total_pages:1,sort_by:null,sort_dir:"desc"}},componentWillMount:function(){_.has(this.props,"rows")||(this.props.rows=[]),_.has(this.props,"cols")||(this.props.rows=[],this.props.cols=[]),_.isArray(this.props.rows)||(this.props.rows=[]),_.isArray(this.props.cols)||(this.props.rows=[],this.props.cols=[])},componentWillReceiveProps:function(t){if(t.rows.length!=this.props.rows.length){var e=Math.ceil(t.rows.length/this.state.limit);this.state.total_pages!=e&&this.setState({total_pages:e})}},formatDefault:function(t){return t},getCols:function(){var t=_.map(this.props.cols,function(t,e,a){return t.hasOwnProperty("key")?(t.hasOwnProperty("name")||(t.name=t.key),t.hasOwnProperty("format")&&_.isFunction(t.format)||(t.format=this.formatDefault),t.hasOwnProperty("edit")&&_.isFunction(t.edit)||(t.edit=null),t):void 0},this);return _.compact(t)},getRows:function(){this.sortRows();var t=this.props.rows.slice(this.getStart(),this.getEnd());return t},getStart:function(){var t=(this.state.page-1)*this.state.limit;return t},getEnd:function(){var t=this.state.page*this.state.limit;return t},onKeyDown:function(t){27==t.keyCode&&this.editExit()},editExit:function(){null!=this.state.edit_idx&&this.setState({edit_idx:null,edit_prop:null})},editCell:function(t,e){this.setState({edit_idx:t,edit_prop:e})},editValue:function(t){t.preventDefault(),this.editExit();var e=$(React.findDOMNode(this.refs.formEdit)),a=e.find("[name=val]").val(),s=e.find("[name=ori]").val();if(a!=s){var i=parseInt(e.find("[name=row_i]").val()),r=this.getStart()+i,n=this.props.rows[r],l=e.find("[name=prop]").val();_.set(this.props.rows[r],l,a);var o=_.filter(this.getCols(),{key:l})[0];o.edit(n,l,a)}},getCell:function(t,e,a,s){var i=s.format(_.get(e,s.key,s["default"]));return this.state.edit_idx==t&&this.state.edit_prop==s.key?React.createElement("td",{key:a},React.createElement("form",{ref:"formEdit",onSubmit:this.editValue},React.createElement("input",{type:"hidden",name:"row_i",value:t}),React.createElement("input",{type:"hidden",name:"prop",value:s.key}),React.createElement("input",{type:"hidden",name:"ori",value:i}),React.createElement("input",{type:"text",name:"val",onKeyDown:this.onKeyDown,defaultValue:i,autoFocus:!0}))):s.edit?React.createElement("td",{key:a,onClick:this.editCell.bind(this,t,s.key),className:"edit"},i):React.createElement("td",{key:a},i)},getPages:function(){for(var t=[],e=this.state.page-4;e<=this.state.page+4;e++)e>0&&e<=this.state.total_pages&&t.push(e);return t},setPage:function(t){this.editExit(),this.setState({page:t})},sortBy:function(t){this.editExit();var e={};this.state.sort_by==t?"desc"==this.state.sort_dir?(e.sort_by=t,e.sort_dir="asc"):(e.sort_by=null,e.sort_dir="desc"):(e.sort_by=t,e.sort_dir="desc"),this.setState(e)},sortRows:function(){this.props.sort_by&&(this.props.rows.sort(function(t,e){var a=t[this.state.sort_by],s=e[this.state.sort_by];return s>a?-1:a>s?1:0}.bind(this)),"desc"==this.state.sort_dir&&(this.props.rows=this.props.rows.reverse()))},render:function(){if(!this.props.hasOwnProperty("rows")||this.props.rows.length<1)return React.createElement("div",{className:"alert alert-default"},"no data");var t=this.getPages(),e=this.getCols(),a=this.getRows();return React.createElement("section",null,React.createElement("a",{name:"library_table"}),React.createElement("br",null),React.createElement("table",{className:"table table-condensed table-sort table-hl"},React.createElement("thead",null,React.createElement("tr",null,_.map(e,function(t,e,a){return React.createElement("th",{key:e,onClick:this.sortBy.bind(this,t.key),className:this.state.sort_by!=t.key?"":"sort-"+this.state.sort_dir},t.name)},this))),React.createElement("tbody",null,_.map(a,function(t,a,s){return React.createElement("tr",{key:a},_.map(e,function(e,s,i){return this.getCell(a,t,s,e)},this))},this)),React.createElement("tfoot",null,React.createElement("tr",null,React.createElement("td",{colSpan:"4"},React.createElement("ul",{className:"pagination"},React.createElement("li",{className:this.state.page<2?"disabled":""},React.createElement("a",{onClick:this.setPage.bind(this,this.state.page-1),href:"#library_table","aria-label":"Previous"},React.createElement("span",{"aria-hidden":"true"},"«"))),t.map(function(t,e,a){return React.createElement("li",{key:e,className:this.state.page==t?"active":""},React.createElement("a",{href:"#library_table",onClick:this.setPage.bind(this,t)},t))}.bind(this)),React.createElement("li",{className:this.state.page>=this.state.total_pages?"disabled":""},React.createElement("a",{onClick:this.setPage.bind(this,this.state.page+1),href:"#library_table","aria-label":"Next"},React.createElement("span",{"aria-hidden":"true"},"»"))))),React.createElement("td",null,React.createElement("span",{className:"pull-right"},this.props.rows.length," rows"))))))}});